<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1" name="viewport"><title>Automatically generating Open Graph images | Bx2 Blog</title><link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/site.webmanifest" rel="manifest"><link href="/safari-pinned-tab.svg" rel="mask-icon" color="#5bbad5"><meta content="#da532c" name="msapplication-TileColor"><meta content="#ffffff" name="theme-color"><script defer src="/bundle.js"></script><link href="/main.8ea44b740c0057685081.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><meta content="From now on, all Open Graph images for my blog posts are automatically generated, so let me elaborate on how I managed to achieve this." data-react-helmet="true" name="description"><meta content="Automatically generating Open Graph images | Bx2 Blog" data-react-helmet="true" property="og:title"><meta content="From now on, all Open Graph images for my blog posts are automatically generated, so let me elaborate on how I managed to achieve this." data-react-helmet="true" property="og:description"><meta content="https://bx2.tech/og/blog/automatically-generating-open-graph-images.png" data-react-helmet="true" property="og:image"><meta content="summary_large_image" data-react-helmet="true" name="twitter:card"><link href="https://fonts.gstatic.com" rel="preconnect"></head><body><div id="root"><header class="header-module__container___hcrqD"><div class="header-module__content___3V1Zo"><a href="/"><img alt="logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTE2IiBoZWlnaHQ9IjQ4IiB2aWV3Qm94PSIwIDAgMTE2IDQ4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMC4xMiA0OFYwLjgzMTk5N0gyNy4yNTZMMzQuMzYgNy45MzZWMTkuMDA4TDMxLjI4OCAyMi40NjRMMzYuNDcyIDI3LjU4NFY0MC44OTZMMjkuMzY4IDQ4SDAuMTJaTTguMTIgMTkuNzc2SDIzLjU0NEwyNi4yOTYgMTYuNTc2VjEwLjY4OEwyMy40OCA3Ljg3Mkg4LjEyVjE5Ljc3NlpNOC4xMiA0MC45NkgyNS41OTJMMjguNDA4IDM4LjE0NFYyOS42MzJMMjUuNTkyIDI2LjgxNkg4LjEyVjQwLjk2Wk00MC45NTI1IDQ4TDUyLjc5MjUgMzAuOTEyTDQwLjk1MjUgMTQuNTI4SDUwLjIzMjVMNTguOTM2NSAyNy4ySDYwLjQ3MjVMNjkuMTEyNSAxNC41MjhINzguMzkyNUw2Ni42MTY1IDMwLjg0OEw3OC4zOTI1IDQ4SDY4LjkyMDVMNjAuNDA4NSAzNC43NTJINTguODA4NUw1MC40ODg1IDQ4SDQwLjk1MjVaTTgzLjM1MDUgNDhWMzguMjA4TDEwNy40NzkgMTYuNDQ4VjEwLjY4OEwxMDQuNjYzIDcuODcySDkyLjgyMjVMODguMTUwNSAxMi41NDRMODIuOTAyNSA3LjIzMkw4OS4zMDI1IDAuODMxOTk3SDEwOC4zNzVMMTE1LjQ3OSA3LjkzNlYxOS43NzZMOTIuNDM4NSA0MC43MDRIMTE1LjkyN1Y0OEg4My4zNTA1WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cg=="></a><nav class="header-module__navigation___-jWYh"><a href="/">Blog</a><a href="/me">Me</a></nav></div></header><div class="contentLayout-module__wrapper___1TkPM"><article><div class="postHeader-module__header___1BbX7"><div class="postHeader-module__topRow___3Sjrr"><a href="/software" class="postHeader-module__topic___22-qX"><img alt="left arrow" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNDQzLjUyIDQ0My41MiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQzLjUyIDQ0My41MjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8Zz4KCTxnPgoJCTxwYXRoIGQ9Ik0xNDMuNDkyLDIyMS44NjNMMzM2LjIyNiwyOS4xMjljNi42NjMtNi42NjQsNi42NjMtMTcuNDY4LDAtMjQuMTMyYy02LjY2NS02LjY2Mi0xNy40NjgtNi42NjItMjQuMTMyLDBsLTIwNC44LDIwNC44CgkJCWMtNi42NjIsNi42NjQtNi42NjIsMTcuNDY4LDAsMjQuMTMybDIwNC44LDIwNC44YzYuNzgsNi41NDgsMTcuNTg0LDYuMzYsMjQuMTMyLTAuNDJjNi4zODctNi42MTQsNi4zODctMTcuMDk5LDAtMjMuNzEyCgkJCUwxNDMuNDkyLDIyMS44NjN6Ii8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==" height="15" width="15"><h3>Software</h3></a><h3 class="postHeader-module__date___38uXN">2021-10-30</h3></div><h1>Automatically generating Open Graph images</h1></div><div class="post-module__content___2TE7E"><a href="#motivation" class="postSectionHeader-module__link___3gkLa"><img alt="Go to motivation" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:10px"><h2 id="motivation">Motivation</h2></a><p class="post-module__p___pJZUm">Not so long ago GitHub <a href="https://github.blog/2021-06-22-framework-building-open-graph-images/" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">updated their platform</a> and made the default Open Graph images for repositories, pull requests, etc. fully automatic. If I'm not mistaken, those pictures are generated on the fly upon a request to a certain route and with some optimizations they managed to reach very impressive performance. Their blog post goes more in-depth about the technical implementation, so make sure to check it out if you're interested. Motivated by this idea, I decided to implement something similar for my blog project, since a default Open Graph image is not very creative.</p><a href="#goals" class="postSectionHeader-module__link___3gkLa"><img alt="Go to goals" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:10px"><h2 id="goals">Goals</h2></a><p class="post-module__p___pJZUm">My goal was also to automatically generate Open Graph images, however, unlike Github, I didn't need to generate images on the fly and could perform the generation when the blog posts changed. Additionally, I didn't aim for the best performance, because it was a fun learning process and I wanted to make something functional (not get rooted in micro-optimization), so you may see some places that can be optimized.</p><a href="#implementation" class="postSectionHeader-module__link___3gkLa"><img alt="Go to implementation" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:10px"><h2 id="implementation">Implementation</h2></a><p class="post-module__p___pJZUm">Like I mentioned in <a href="/software/creating-a-blog-from-scratch" class="post-module__link___3JDsk">one of my older posts</a>, the blog posts in this project are represented by <code class="post-module__code___Zc_tE">mdx</code> files in the <code class="post-module__code___Zc_tE">src/assets/blog</code> <a href="https://github.com/BenasB/benasb.github.io/tree/dev/src/assets/blog" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">directory</a>. Keeping this in mind we can separate the generation process into these steps:</p><ol class="post-module__list___3c5Q4"><li class="post-module__li___2TyKt">Read an <code class="post-module__code___Zc_tE">mdx</code> file from the <code class="post-module__code___Zc_tE">src/assets/blog</code> directory.</li><li class="post-module__li___2TyKt">Extract the <code class="post-module__code___Zc_tE">meta</code> object from the file.</li><li class="post-module__li___2TyKt">Put needed data from the <code class="post-module__code___Zc_tE">meta</code> object to a template.</li><li class="post-module__li___2TyKt">Take a screenshot of that template and save it to a file.</li></ol><p class="post-module__p___pJZUm">Step 1 is pretty simple and can be handled with <a href="https://nodejs.org/api/fs.html" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank"><code class="post-module__code___Zc_tE">fs</code></a> and <a href="https://www.npmjs.com/package/glob" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank"><code class="post-module__code___Zc_tE">glob</code></a>. However, this took some time, because I had to get used to asynchronous programming and the various ways it can be achieved (callbacks, promises, async/await).</p><p class="post-module__p___pJZUm">Step 2 is handled by <a href="https://www.npmjs.com/package/extract-mdx-metadata" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank"><code class="post-module__code___Zc_tE">extract-mdx-metadata</code></a>. Although it doesn't have TypeScript support, I managed to adapt it to my needs. It's good that I chose to use <code class="post-module__code___Zc_tE">mdx</code> files from the start because there are ways to <a href="https://mdxjs.com/advanced/transform-content/" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">transform</a> the content and people have already created packages that help you. It's also a good time to mention that almost the same steps 1 and 2 are done using <a href="https://github.com/BenasB/benasb.github.io/blob/dev/src/utils/importFiles.tsx" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank"><code class="post-module__code___Zc_tE">importFiles</code></a> function when building the front end, however I can't reuse it here, because it depends on webpack and needs to be bundled/processed.</p><p class="post-module__p___pJZUm">For step 3 I use a <a href="https://handlebarsjs.com/" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">handlebars</a> template which is basically HTML with variables. I'm pretty sure it has quite a few features, however I just needed to take in an object and display some of its properties in certain HTML tags, so it's a great simple syntax solution. You can check out the template file <a href="https://github.com/BenasB/benasb.github.io/blob/dev/src/templates/og.hbs" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">here</a>. I chose to add the title and release date to the template.</p><p class="post-module__p___pJZUm">Step 4 is performed by <a href="https://www.npmjs.com/package/node-html-to-image" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank"><code class="post-module__code___Zc_tE">node-html-to-image</code></a>. This is a great package as it consumes the handlebars template and takes a screenshot of it using <a href="https://developers.google.com/web/tools/puppeteer" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">puppeteer</a> under the hood. Probably performance suffers here the most due to the fact that puppeteer needs a lot of resources to function.</p><p class="post-module__p___pJZUm">Here's an example Open Graph image for the previously mentioned <a href="/software/creating-a-blog-from-scratch" class="post-module__link___3JDsk">blog post</a>:</p><p class="post-module__p___pJZUm"><span class="lazy-load-image-background blur" style="width:100%"><span class="" style="display:block;margin:0 auto;max-width:100%"></span></span></p><a href="#running-the-generation" class="postSectionHeader-module__link___3gkLa"><img alt="Go to running-the-generation" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:10px"><h2 id="running-the-generation">Running the generation</h2></a><p class="post-module__p___pJZUm">With the generation process in place, I had to decide when to perform it, because doing it manually is not very productive. I could run the generation every time I commit or push my changes to git by utilizing <a href="https://typicode.github.io/husky/#/" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">husky</a>, however I took it a step further and made it so that the Open Graph images are generated during the <code class="post-module__code___Zc_tE">pre-commit</code> phase if <strong>there are changes</strong> to the <code class="post-module__code___Zc_tE">src/assets/blog</code> directory where all of the blog post files are located.</p><a href="#improvements-for-the-future" class="postSectionHeader-module__link___3gkLa"><img alt="Go to improvements-for-the-future" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:10px"><h2 id="improvements-for-the-future">Improvements for the future</h2></a><p class="post-module__p___pJZUm">In theory, you could generate the images only for the files that changed (not the whole directory), but I'll probably leave that for the future. I'm also not fully sure about the template design, but I think I'll figure it out and find a better visual design as time goes.</p><p class="post-module__p___pJZUm">You can check out the generation source code <a href="https://github.com/BenasB/benasb.github.io/blob/dev/src/utils/generateOgImages.ts" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">here</a>.</p></div></article></div></div></body></html>