<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1" name="viewport"><title>Deploying ASP.NET Core on a Raspberry Pi using Docker | Bx2 Blog</title><link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/site.webmanifest" rel="manifest"><link href="/safari-pinned-tab.svg" rel="mask-icon" color="#5bbad5"><meta content="#da532c" name="msapplication-TileColor"><meta content="#ffffff" name="theme-color"><script defer src="/bundle.js"></script><link href="/main.58a3a0ef94afd77dce3c.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><meta content="Utilizing my Raspberry Pi 3B to run one of the projects I made a while ago with the help of docker" data-react-helmet="true" name="description"><meta content="Deploying ASP.NET Core on a Raspberry Pi using Docker | Bx2 Blog" data-react-helmet="true" property="og:title"><meta content="Utilizing my Raspberry Pi 3B to run one of the projects I made a while ago with the help of docker" data-react-helmet="true" property="og:description"><meta content="https://bx2.tech/og/blog/asp-net-core-on-raspberry-pi-with-docker.png" data-react-helmet="true" property="og:image"><meta content="summary_large_image" data-react-helmet="true" name="twitter:card"><link href="https://fonts.gstatic.com" rel="preconnect"></head><body><div id="root"><div class="theme--light"><div class="app-module__app___2OdXP"><header class="header-module__container___hcrqD"><div class="header-module__content___3V1Zo"><a href="/"><img alt="logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTE2IiBoZWlnaHQ9IjQ4IiB2aWV3Qm94PSIwIDAgMTE2IDQ4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMC4xMiA0OFYwLjgzMTk5N0gyNy4yNTZMMzQuMzYgNy45MzZWMTkuMDA4TDMxLjI4OCAyMi40NjRMMzYuNDcyIDI3LjU4NFY0MC44OTZMMjkuMzY4IDQ4SDAuMTJaTTguMTIgMTkuNzc2SDIzLjU0NEwyNi4yOTYgMTYuNTc2VjEwLjY4OEwyMy40OCA3Ljg3Mkg4LjEyVjE5Ljc3NlpNOC4xMiA0MC45NkgyNS41OTJMMjguNDA4IDM4LjE0NFYyOS42MzJMMjUuNTkyIDI2LjgxNkg4LjEyVjQwLjk2Wk00MC45NTI1IDQ4TDUyLjc5MjUgMzAuOTEyTDQwLjk1MjUgMTQuNTI4SDUwLjIzMjVMNTguOTM2NSAyNy4ySDYwLjQ3MjVMNjkuMTEyNSAxNC41MjhINzguMzkyNUw2Ni42MTY1IDMwLjg0OEw3OC4zOTI1IDQ4SDY4LjkyMDVMNjAuNDA4NSAzNC43NTJINTguODA4NUw1MC40ODg1IDQ4SDQwLjk1MjVaTTgzLjM1MDUgNDhWMzguMjA4TDEwNy40NzkgMTYuNDQ4VjEwLjY4OEwxMDQuNjYzIDcuODcySDkyLjgyMjVMODguMTUwNSAxMi41NDRMODIuOTAyNSA3LjIzMkw4OS4zMDI1IDAuODMxOTk3SDEwOC4zNzVMMTE1LjQ3OSA3LjkzNlYxOS43NzZMOTIuNDM4NSA0MC43MDRIMTE1LjkyN1Y0OEg4My4zNTA1WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cg=="></a><nav class="header-module__navigation___-jWYh"><a href="/">Blog</a><a href="/me">Me</a><button class="themeToggle-module__button___2vCkC"><img alt="Sun theme toggle" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDIwOC45NDggMjA4Ljk0OCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjA4Ljk0OCAyMDguOTQ4OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8cGF0aCBzdHlsZT0iZmlsbDojMUQxRDFCOyIgZD0iTTEwNC40NzQsMzguMzE3Yy0zNi40NzksMC02Ni4xNTgsMjkuNjc4LTY2LjE1OCw2Ni4xNTdzMjkuNjc4LDY2LjE1Nyw2Ni4xNTgsNjYuMTU3DQoJCXM2Ni4xNTgtMjkuNjc4LDY2LjE1OC02Ni4xNTdTMTQwLjk1NCwzOC4zMTcsMTA0LjQ3NCwzOC4zMTd6IE0xMDQuNDc0LDE1NS42MzJjLTI4LjIwOCwwLTUxLjE1OC0yMi45NDktNTEuMTU4LTUxLjE1Nw0KCQlzMjIuOTQ5LTUxLjE1Nyw1MS4xNTgtNTEuMTU3czUxLjE1OCwyMi45NDksNTEuMTU4LDUxLjE1N1MxMzIuNjgzLDE1NS42MzIsMTA0LjQ3NCwxNTUuNjMyeiIvPg0KCTxwYXRoIHN0eWxlPSJmaWxsOiMxRDFEMUI7IiBkPSJNMTAzLjkyOSwzMi4yMjhjMC4wMTcsMCwwLjAzNSwwLDAuMDUyLDBjNC4xNDItMC4wMjgsNy40NzctMy40MDksNy40NDktNy41NTFMMTExLjMxMyw3LjQ1DQoJCWMtMC4wMjktNC4xNDMtMy40MDItNy41MTYtNy41NTEtNy40NDljLTQuMTQyLDAuMDI4LTcuNDc3LDMuNDA5LTcuNDQ5LDcuNTUxbDAuMTE3LDE3LjIyNw0KCQlDOTYuNDU4LDI4LjkwMyw5OS44MTEsMzIuMjI4LDEwMy45MjksMzIuMjI4eiIvPg0KCTxwYXRoIHN0eWxlPSJmaWxsOiMxRDFEMUI7IiBkPSJNMTYwLjQ3OSw1NS4yYzEuOTM3LDAsMy44NzMtMC43NDUsNS4zNC0yLjIzMmwxMi4wOTgtMTIuMjY0YzIuOTA5LTIuOTQ5LDIuODc2LTcuNjk4LTAuMDcyLTEwLjYwNg0KCQljLTIuOTUtMi45MTEtNy42OTgtMi44NzgtMTAuNjA2LDAuMDcxTDE1NS4xNCw0Mi40MzNjLTIuOTA5LDIuOTQ5LTIuODc2LDcuNjk4LDAuMDcyLDEwLjYwNg0KCQlDMTU2LjY3Myw1NC40ODEsMTU4LjU3Niw1NS4yLDE2MC40NzksNTUuMnoiLz4NCgk8cGF0aCBzdHlsZT0iZmlsbDojMUQxRDFCOyIgZD0iTTIwMS40NDksOTYuMzEzYy0wLjAxNywwLTAuMDM1LDAtMC4wNTIsMGwtMTcuMjI3LDAuMTE3Yy00LjE0MiwwLjAyOC03LjQ3NywzLjQwOS03LjQ0OSw3LjU1MQ0KCQljMC4wMjgsNC4xMjUsMy4zOCw3LjQ0OSw3LjQ5OSw3LjQ0OWMwLjAxNywwLDAuMDM1LDAsMC4wNTIsMGwxNy4yMjctMC4xMTdjNC4xNDItMC4wMjgsNy40NzctMy40MDksNy40NDktNy41NTENCgkJQzIwOC45MTksOTkuNjM4LDIwNS41NjcsOTYuMzEzLDIwMS40NDksOTYuMzEzeiIvPg0KCTxwYXRoIHN0eWxlPSJmaWxsOiMxRDFEMUI7IiBkPSJNMTY2LjUxNSwxNTUuMTQxYy0yLjk0OS0yLjkxMS03LjY5OC0yLjg3OC0xMC42MDYsMC4wNzFjLTIuOTA5LDIuOTQ5LTIuODc2LDcuNjk4LDAuMDcyLDEwLjYwNg0KCQlsMTIuMjY0LDEyLjA5OWMxLjQ2MSwxLjQ0MiwzLjM2NCwyLjE2MSw1LjI2NywyLjE2MWMxLjkzNywwLDMuODczLTAuNzQ1LDUuMzQtMi4yMzJjMi45MDktMi45NDksMi44NzYtNy42OTgtMC4wNzItMTAuNjA2DQoJCUwxNjYuNTE1LDE1NS4xNDF6Ii8+DQoJPHBhdGggc3R5bGU9ImZpbGw6IzFEMUQxQjsiIGQ9Ik0xMDQuOTY3LDE3Ni43MjJjLTQuMTQyLDAuMDI4LTcuNDc3LDMuNDA5LTcuNDQ5LDcuNTUxbDAuMTE3LDE3LjIyNw0KCQljMC4wMjgsNC4xMjUsMy4zOCw3LjQ0OSw3LjQ5OSw3LjQ0OWMwLjAxNywwLDAuMDM1LDAsMC4wNTIsMGM0LjE0Mi0wLjAyOCw3LjQ3Ny0zLjQwOSw3LjQ0OS03LjU1MWwtMC4xMTctMTcuMjI3DQoJCUMxMTIuNDksMTgwLjAyOCwxMDkuMDkzLDE3Ni43MDgsMTA0Ljk2NywxNzYuNzIyeiIvPg0KCTxwYXRoIHN0eWxlPSJmaWxsOiMxRDFEMUI7IiBkPSJNNDMuMTMsMTU1Ljk4MWwtMTIuMDk4LDEyLjI2NGMtMi45MDksMi45NDktMi44NzYsNy42OTgsMC4wNzIsMTAuNjA2DQoJCWMxLjQ2MSwxLjQ0MiwzLjM2NCwyLjE2MSw1LjI2NywyLjE2MWMxLjkzNywwLDMuODczLTAuNzQ1LDUuMzQtMi4yMzJsMTIuMDk4LTEyLjI2NGMyLjkwOS0yLjk0OSwyLjg3Ni03LjY5OC0wLjA3Mi0xMC42MDYNCgkJQzUwLjc4NywxNTIuOTk5LDQ2LjAzOCwxNTMuMDMyLDQzLjEzLDE1NS45ODF6Ii8+DQoJPHBhdGggc3R5bGU9ImZpbGw6IzFEMUQxQjsiIGQ9Ik0zMi4yMjcsMTA0Ljk2OGMtMC4wMjgtNC4xMjUtMy4zOC03LjQ0OS03LjQ5OS03LjQ0OWMtMC4wMTcsMC0wLjAzNSwwLTAuMDUyLDBMNy40NSw5Ny42MzYNCgkJYy00LjE0MiwwLjAyOC03LjQ3NywzLjQwOS03LjQ0OSw3LjU1MWMwLjAyOCw0LjEyNSwzLjM4LDcuNDQ5LDcuNDk5LDcuNDQ5YzAuMDE3LDAsMC4wMzUsMCwwLjA1MiwwbDE3LjIyNy0wLjExNw0KCQlDMjguOTIsMTEyLjQ5LDMyLjI1NSwxMDkuMTA5LDMyLjIyNywxMDQuOTY4eiIvPg0KCTxwYXRoIHN0eWxlPSJmaWxsOiMxRDFEMUI7IiBkPSJNNDIuNDMzLDUzLjgwOWMxLjQ2MSwxLjQ0MiwzLjM2NCwyLjE2MSw1LjI2NywyLjE2MWMxLjkzNywwLDMuODczLTAuNzQ1LDUuMzQtMi4yMzINCgkJYzIuOTA5LTIuOTQ5LDIuODc2LTcuNjk4LTAuMDcyLTEwLjYwNkw0MC43MDMsMzEuMDMyYy0yLjk0OS0yLjkxMi03LjY5OC0yLjg3Ny0xMC42MDYsMC4wNzENCgkJYy0yLjkwOSwyLjk0OS0yLjg3Niw3LjY5OCwwLjA3MiwxMC42MDZMNDIuNDMzLDUzLjgwOXoiLz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjwvc3ZnPg0K" class="themeToggle-module__image___3krKY"></button></nav></div></header><div class="contentLayout-module__wrapper___1TkPM"><article><div class="postHeader-module__header___1BbX7"><div class="postHeader-module__topRow___3Sjrr"><a href="/software" class="postHeader-module__topic___22-qX"><img alt="left arrow" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNDQzLjUyIDQ0My41MiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQzLjUyIDQ0My41MjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8Zz4KCTxnPgoJCTxwYXRoIGQ9Ik0xNDMuNDkyLDIyMS44NjNMMzM2LjIyNiwyOS4xMjljNi42NjMtNi42NjQsNi42NjMtMTcuNDY4LDAtMjQuMTMyYy02LjY2NS02LjY2Mi0xNy40NjgtNi42NjItMjQuMTMyLDBsLTIwNC44LDIwNC44CgkJCWMtNi42NjIsNi42NjQtNi42NjIsMTcuNDY4LDAsMjQuMTMybDIwNC44LDIwNC44YzYuNzgsNi41NDgsMTcuNTg0LDYuMzYsMjQuMTMyLTAuNDJjNi4zODctNi42MTQsNi4zODctMTcuMDk5LDAtMjMuNzEyCgkJCUwxNDMuNDkyLDIyMS44NjN6Ii8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==" height="15" width="15"><h3>Software</h3></a><h3 class="postHeader-module__date___38uXN">2022-05-10</h3></div><h1>Deploying ASP.NET Core on a Raspberry Pi using Docker</h1></div><div class="post-module__content___2TE7E"><a href="#motivation" class="postSectionHeader-module__link___3gkLa"><img alt="Go to motivation" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:10px"><h2 id="motivation">Motivation</h2></a><p class="post-module__p___pJZUm">I had a <a href="https://www.raspberrypi.org/" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">Raspberry Pi</a> 3B and figured it would be a good machine to run my personal projects. I don't need a lot of computing power so it fits my needs nicely. I also had a project that I made a while ago called <a href="http://github.com/BenasB/PUTS" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">PUTS</a> where the main part is an ASP.NET Core MVC project called PUTSWeb (I'll be using them interchangeably). Combining these two would certainly be an interesting learning experience.</p><a href="#goal" class="postSectionHeader-module__link___3gkLa"><img alt="Go to goal" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:10px"><h2 id="goal">Goal</h2></a><p class="post-module__p___pJZUm">Use CI/CD to automatically deploy and run the PUTS project on my Raspberry Pi.</p><a href="#implementation" class="postSectionHeader-module__link___3gkLa"><img alt="Go to implementation" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:10px"><h2 id="implementation">Implementation</h2></a><p class="post-module__p___pJZUm">PUTS depends on a MySQL database to store information about users, problems and solutions meaning that I'd need to also deploy a database alongside PUTS. For that purpose, I chose to use the last missing part of this article – <a href="https://www.docker.com/" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">Docker</a>. There's already an image for MySQL meaning that I could deploy the database using Docker and deploy PUTS regularly using dotnet, however, I decided to containerize PUTS and use <a href="https://docs.docker.com/compose/" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">Docker Compose</a> as this is probably the most convenient approach for me.</p><p class="post-module__p___pJZUm">Firstly I had to containerize PUTS. I decided to do all of the actual .NET building outside the Dockerfile in the CI/CD runner so that the image size is kept as small as possible. Because of this, the <a href="https://github.com/BenasB/PUTS/blob/master/PUTSWeb/Dockerfile" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">Dockerfile</a> came out very small and simple:</p><pre class="prism-code language-js" style="color:#9cdcfe;background-color:#1e1e1e;padding:20px;border-radius:5px;overflow:auto"><div class="token-line" style="color:#9cdcfe"><span class="token constant" style="color:#646695">FROM</span><span class="token plain"> mcr</span><span class="token punctuation" style="color:#d4d4d4">.</span><span class="token property-access">microsoft</span><span class="token punctuation" style="color:#d4d4d4">.</span><span class="token property-access">com</span><span class="token operator" style="color:#d4d4d4">/</span><span class="token plain">dotnet</span><span class="token operator" style="color:#d4d4d4">/</span><span class="token plain">aspnet</span><span class="token operator" style="color:#d4d4d4">:</span><span class="token number" style="color:#b5cea8">2.1</span><span class="token operator" style="color:#d4d4d4">-</span><span class="token plain">bionic</span><span class="token operator" style="color:#d4d4d4">-</span><span class="token plain">arm32v7</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain"></span><span class="token constant" style="color:#646695">RUN</span><span class="token plain"> apt</span><span class="token operator" style="color:#d4d4d4">-</span><span class="token keyword" style="color:#569cd6">get</span><span class="token plain"> update </span><span class="token operator" style="color:#d4d4d4">&&</span><span class="token plain"> apt </span><span class="token operator" style="color:#d4d4d4">-</span><span class="token plain">y install g</span><span class="token operator" style="color:#d4d4d4">++</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain"></span><span class="token constant" style="color:#646695">WORKDIR</span><span class="token plain"> </span><span class="token operator" style="color:#d4d4d4">/</span><span class="token plain">app</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain"></span><span class="token constant" style="color:#646695">COPY</span><span class="token plain"> published</span><span class="token operator" style="color:#d4d4d4">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#d4d4d4">.</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain"></span><span class="token constant" style="color:#646695">ENTRYPOINT</span><span class="token plain"> </span><span class="token punctuation" style="color:#d4d4d4">[</span><span class="token string" style="color:#ce9178">"dotnet"</span><span class="token punctuation" style="color:#d4d4d4">,</span><span class="token plain"> </span><span class="token string" style="color:#ce9178">"PUTSWeb.dll"</span><span class="token punctuation" style="color:#d4d4d4">]</span></div></pre><ul class="post-module__list___3c5Q4"><li class="post-module__li___2TyKt">I need <code class="post-module__code___Zc_tE">g++</code> in the container because PUTS uses <code class="post-module__code___Zc_tE">g++</code> to compile the user submitted programs.</li><li class="post-module__li___2TyKt">I'm using the <code class="post-module__code___Zc_tE">-bionic-arm32v7</code> version of the dotnet image because I'm making an image for a Raspberry Pi 3B and its architecture is <code class="post-module__code___Zc_tE">arm32v7</code> (keep in mind that newer Raspberry Pis have a different one).</li></ul><p class="post-module__p___pJZUm">In theory, I could now build a docker image for PUTS (in practice I couldn't directly build an image for a different architecture) that I'll eventually push to <a href="https://hub.docker.com/u/benasbudrys" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">Docker Hub</a>. The next implementation step was to create a <code class="post-module__code___Zc_tE">docker-compose</code> file which I refer to as <a href="https://github.com/BenasB/PUTS/blob/master/Infrastructure/rpi-stack.yml" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">rpi-stack.yml</a>:</p><pre class="prism-code language-yml" style="color:#9cdcfe;background-color:#1e1e1e;padding:20px;border-radius:5px;overflow:auto"><div class="token-line" style="color:#9cdcfe"><span class="token key atrule">version</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> </span><span class="token string" style="color:#ce9178">'3.1'</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  </span><span class="token key atrule">puts</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> benasbudrys/putsweb</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> always</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> 8000</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token number" style="color:#b5cea8">5001</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> keys</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain">/app/Keys</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> ~/.aspnet/https</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain">/https</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain">ro</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> db</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token key atrule">ConnectionStrings__ProblemDatabase</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $ConnectionStrings__ProblemDatabase</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token key atrule">ASPNETCORE_Kestrel__Certificates__Default__Password</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $ASPNETCORE_Kestrel__Certificates__Default__Password</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token key atrule">ASPNETCORE_Kestrel__Certificates__Default__Path</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $ASPNETCORE_Kestrel__Certificates__Default__Path</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token key atrule">ASPNETCORE_URLS</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain">//+</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token number" style="color:#b5cea8">5001</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  </span><span class="token key atrule">db</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> jsurf/rpi</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">mariadb</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> always</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> 8001</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token number" style="color:#b5cea8">3306</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> db</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain">/var/lib/mysql</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $MYSQL_ROOT_PASSWORD</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  </span><span class="token key atrule">adminer</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> adminer</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> always</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> 8002</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token number" style="color:#b5cea8">8080</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  </span><span class="token key atrule">db-data</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  keys</span><span class="token punctuation" style="color:#d4d4d4">:</span></div></pre><p class="post-module__p___pJZUm">There are a couple of things worth noting about this compose file:</p><ul class="post-module__list___3c5Q4"><li class="post-module__li___2TyKt">The service <code class="post-module__code___Zc_tE">adminer</code> is completely optional, I just wanted something to conveniently check my database.</li><li class="post-module__li___2TyKt">I'm using <code class="post-module__code___Zc_tE">jsurf/rpi-mariadb</code> instead of a regular <code class="post-module__code___Zc_tE">mysql</code> image for the database because this one is suited for a Raspberry Pi.</li><li class="post-module__li___2TyKt">Ports <em>8000</em>, <em>8001</em> and <em>8002</em> are completely arbitrary</li><li class="post-module__li___2TyKt">There are several environment variables that will be passed in the compose file via GitHub environment variables.</li><li class="post-module__li___2TyKt">There are project specific volumes for ASP.NET Core Identity and <a href="https://docs.microsoft.com/en-us/aspnet/core/security/docker-compose-https?view=aspnetcore-6.0" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">HTTPS certificate</a>.</li></ul><p class="post-module__p___pJZUm">I now had a Dockerfile and a compose/stack file for my project, all I needed now is to somehow get everything onto the Raspberry Pi and compose up the stack. It's finally time for the pipeline which consists of these logical steps:</p><ol class="post-module__list___3c5Q4"><li class="post-module__li___2TyKt">Build and publish Docker image<ol class="post-module__list___3c5Q4"><li class="post-module__li___2TyKt">Setup dotnet</li><li class="post-module__li___2TyKt">Build dotnet</li><li class="post-module__li___2TyKt">Publish dotnet</li><li class="post-module__li___2TyKt">Build Docker image</li><li class="post-module__li___2TyKt">Push Docker image to Docker Hub</li></ol></li><li class="post-module__li___2TyKt">Deploy on Raspberry Pi<ol class="post-module__list___3c5Q4"><li class="post-module__li___2TyKt">Copy stack file over to the Pi</li><li class="post-module__li___2TyKt">Compose pull</li><li class="post-module__li___2TyKt">Compose up</li></ol></li></ol><p class="post-module__p___pJZUm">I store all of my personal projects on <a href="https://github.com/BenasB" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">my GitHub</a> so I'll be using Github Actions to create a CI/CD pipeline. The <a href="https://github.com/BenasB/PUTS/blob/master/.github/workflows/putsweb.yml" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">pipeline</a> I'm currently using came out like this (don't be discouraged by quite a few steps):</p><pre class="prism-code language-yml" style="color:#9cdcfe;background-color:#1e1e1e;padding:20px;border-radius:5px;overflow:auto"><div class="token-line" style="color:#9cdcfe"><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> PUTSWeb</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain"></span><span class="token key atrule">on</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  </span><span class="token key atrule">push</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">branches</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#d4d4d4">[</span><span class="token plain">master</span><span class="token punctuation" style="color:#d4d4d4">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  </span><span class="token key atrule">workflow_dispatch</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  </span><span class="token key atrule">docker-image</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Build and publish docker image</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">latest</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">defaults</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token key atrule">run</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">working-directory</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> ./PUTSWeb</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Checkout 🛎️</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> actions/checkout@v3</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Setup .NET 🌐</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">dotnet@v2</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">dotnet-version</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> </span><span class="token number" style="color:#b5cea8">2.1</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Build dotnet 🔧</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">run</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> dotnet build</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Publish 📦</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">run</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> dotnet publish </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">c Release </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">o published</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Set up QEMU 🔨</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> docker/setup</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">qemu</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">action@v1</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Set up Docker Buildx 🪛</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">id</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> buildx</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> docker/setup</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">buildx</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">action@v1</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Login to Docker Hub 🐋</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> docker/login</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">action@v1</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.DOCKER_HUB_USERNAME </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.DOCKER_HUB_ACCESS_TOKEN </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Build and push ⬆️</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> docker/build</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">push</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">action@v2</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">context</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> ./PUTSWeb/</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">platforms</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> linux/arm/v7</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">push</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">tags</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.DOCKER_HUB_USERNAME </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain">/putsweb</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain">latest</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">  </span><span class="token key atrule">deploy-rpi</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Deploy stack to raspberry pi</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">needs</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">image</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">latest</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> pi</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token key atrule">url</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain">//benaspi.ddns.net</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token number" style="color:#b5cea8">8000</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Checkout 🛎️</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> actions/checkout@v3</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Copy stack file 📁</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> appleboy/scp</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">action@master</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">host</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_HOST </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_USERNAME </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_PASSWORD </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">source</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> </span><span class="token string" style="color:#ce9178">'Infrastructure/rpi-stack.yml'</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">target</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> </span><span class="token string" style="color:#ce9178">'~/stacks/putsweb/'</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">strip_components</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> </span><span class="token number" style="color:#b5cea8">1</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Compose pull ⬇️</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> appleboy/ssh</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">action@master</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">host</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_HOST </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_USERNAME </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_PASSWORD </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">script</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">compose </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">f ~/stacks/putsweb/rpi</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">stack.yml pull</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Compose up 🚀</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> appleboy/ssh</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">action@master</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">host</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_HOST </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_USERNAME </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_PASSWORD </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">script</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#d4d4d4">|</span><span class="token scalar string" style="color:#ce9178"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token scalar string" style="color:#ce9178">            export ConnectionStrings__ProblemDatabase="${{ secrets.CONNECTIONSTRINGS__PROBLEMDATABASE }}"</span></div><div class="token-line" style="color:#9cdcfe"><span class="token scalar string" style="color:#ce9178">            export MYSQL_ROOT_PASSWORD="${{ secrets.MYSQL_ROOT_PASSWORD }}"</span></div><div class="token-line" style="color:#9cdcfe"><span class="token scalar string" style="color:#ce9178">            export ASPNETCORE_Kestrel__Certificates__Default__Password="${{ secrets.ASPNETCORE_KESTREL__CERTIFICATES__DEFAULT__PASSWORD }}"</span></div><div class="token-line" style="color:#9cdcfe"><span class="token scalar string" style="color:#ce9178">            export ASPNETCORE_Kestrel__Certificates__Default__Path="${{ secrets.ASPNETCORE_KESTREL__CERTIFICATES__DEFAULT__PATH }}"</span></div><div class="token-line" style="color:#9cdcfe"><span class="token scalar string" style="color:#ce9178">            docker-compose -f ~/stacks/putsweb/rpi-stack.yml up -d</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">      </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> Check running containers 🔍</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> appleboy/ssh</span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">action@master</span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">host</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_HOST </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_USERNAME </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token punctuation" style="color:#d4d4d4">{</span><span class="token plain"> secrets.RPI_PASSWORD </span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token punctuation" style="color:#d4d4d4">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9cdcfe"><span class="token plain">          </span><span class="token key atrule">script</span><span class="token punctuation" style="color:#d4d4d4">:</span><span class="token plain"> docker ps </span><span class="token punctuation" style="color:#d4d4d4">-</span><span class="token plain">a</span></div></pre><p class="post-module__p___pJZUm">Some comments about the pipeline:</p><ul class="post-module__list___3c5Q4"><li class="post-module__li___2TyKt">It makes use of other pre-built GitHub Actions (as it should) to for example copy over the stack file to the Raspberry Pi.</li><li class="post-module__li___2TyKt"><code class="post-module__code___Zc_tE">QEMU</code> and <code class="post-module__code___Zc_tE">Buildx</code> are needed to build the image since this runner is using ubuntu and I'm building an image for the <code class="post-module__code___Zc_tE">arm32v7</code> architecture.</li><li class="post-module__li___2TyKt">All sensitive data is handled by GitHub repository secrets and environment secrets.</li></ul><p class="post-module__p___pJZUm">With everything in place, I was able to achieve what I wanted – upon PUTS code changes, a pipeline starts automatically, builds a Docker image for the PUTS project, pushes it to the Docker Hub and deploys the stack on the Raspberry Pi. What I like is that most of the things related to this project live in the repository together with PUTS code – I can see and change the stack file, update the pipeline etc.</p><p class="post-module__p___pJZUm"><span class="lazy-load-image-background blur" style="width:100%"><span class="" style="display:block;margin:0 auto;max-width:100%"></span></span></p><a href="#raspberry-pi-as-a-runner" class="postSectionHeader-module__link___3gkLa"><img alt="Go to raspberry-pi-as-a-runner" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBkPSJNMTMuNTQ0IDEwLjQ1NmE0LjM2OCA0LjM2OCAwIDAgMC02LjE3NiAwbC0zLjA4OSAzLjA4OGE0LjM2NyA0LjM2NyAwIDEgMCA2LjE3NyA2LjE3N0wxMiAxOC4xNzciIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xMC40NTYgMTMuNTQ0YTQuMzY4IDQuMzY4IDAgMCAwIDYuMTc2IDBsMy4wODktMy4wODhhNC4zNjcgNC4zNjcgMCAxIDAtNi4xNzctNi4xNzdMMTIgNS44MjMiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4=" class="postSectionHeader-module__icon___1JDVu" style="top:2px"><h3 id="raspberry-pi-as-a-runner">Raspberry Pi as a runner</h3></a><p class="post-module__p___pJZUm">I also experimented a bit with the idea of having the Raspberry Pi act as a <a href="https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">GitHub Actions runner</a>. However, I scrapped this idea because I didn't want to put additional load on the Pi itself and the runners provided by GitHub have more resources/are faster.</p><p class="post-module__p___pJZUm"><em>Just a heads up that the actual progress wasn't as straightforward as I've described in this article and I've discovered a lot of things with trial and error</em></p><p class="post-module__p___pJZUm">You can see PUTS running on the Raspberry Pi <a href="https://benaspi.ddns.net:8000" class="post-module__link___3JDsk" rel="noopener noreferrer" target="_blank">here</a>.</p></div></article></div></div></div></div></body></html>